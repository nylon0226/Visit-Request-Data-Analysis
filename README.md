（ExcelVBA）
#🏥 新規依頼に関するデータ分析 — Data Analysis Tool for Home-Visit Nursing


## 📖 概要
本ツールは、**訪問看護ステーションの経営企画部門**で実際に使用された、  
新規依頼データの可視化・分析用ExcelVBAブックです。  

外部機関（病院・クリニック・ケアマネージャー等）からの訪問依頼情報を  
自動で整理・仕分け・集計し、  
依頼元の傾向分析や契約率の可視化を可能にします。  

---

## 🧭 主な機能

### 🗂️ 1. 事業所ごとのデータ自動仕分け
- 「ALL」シートのB列（事業所名）を基準に、  
　**自動で各事業所の個別シートを生成**します。  
- すでに存在するシートは上書き更新され、  
　新規事業所が検出された場合は「原本」シートをコピーして新規作成。

### 📋 2. データ転送・更新機能
- 「ALL」シートのA〜H列に入力された依頼データを、  
　該当する事業所シートへ自動転送。  
- ダブルクリック操作一つで、**全シートが最新状態に更新**されます。  
- 重複データは「シートの重複削除」ルーチンで整理。

### 📊 3. 自動集計機能
- 「ALL」シート右部（J〜L列）にて自動的に集計を出力：
  | 列 | 内容 |
  |----|------|
  | J列 | 事業所名 |
  | K列 | 該当依頼件数 |
  | L列 | 「×」件数（未契約数など） |

- これにより、依頼元別の依頼数・契約率を即座に把握可能。

### 💡 4. データ視点
- 医療保険／介護保険別の分析  
- 依頼時期（季節・月ごとの分布）  
- 依頼元別の契約率（「×」の数で可視化）  
- 外部機関（病院・クリニック・CM等）の傾向比較

---

## ⚙️ 動作手順

1. Excelマクロを有効化して `新規依頼に関するデータ分析.xlsm` を開く  
2. 「ALL」シートに依頼データを入力（A〜H列）  
   - B列：事業所名（必須）  
   - E列：「×」=契約未成立、空欄または○=成立  
3. 任意のセルをダブルクリック  
   - 自動的に事業所シートを生成・更新  
   - ALLシート右部に集計が出力される  

---

## 🧩 VBA構成

### ▶ メイン処理：`Worksheet_BeforeDoubleClick`
- ダブルクリックで実行開始  
- 各事業所シートの更新・重複削除を制御

### ▶ サブルーチン一覧
| サブルーチン名 | 機能概要 |
|----------------|----------|
| `取得と格納` | ALLシートから事業所名を抽出し、一意の配列へ格納。新規シート生成も実行。 |
| `文字列のカウントと格納` | 各事業所ごとの依頼件数と×件数をカウントし、ALLシートJ〜L列に出力。 |
| `シートの重複削除` | 各事業所シート内の重複行を削除（既存処理を再利用）。 |
| `SheetExists` | シート存在確認関数。 |
| `Contains` | Collection内要素の存在確認関数。 |

---

## 🧮 シート構成
| シート名 | 役割 |
|-----------|------|
| `ALL` | すべての依頼データを集約・管理。自動更新の中心となる。 |
| `原本` | 新規事業所シート生成時のテンプレート。 |
| `（事業所名）` | 自動生成される事業所別シート。 |

---

## 🧠 技術的ポイント
- `Worksheet_BeforeDoubleClick` イベントを用いた**ワンクリック自動更新設計**  
- `Collection`による**重複排除と配列転送の最適化**  
- `SheetExists`関数による**安全な動的シート生成**  
- `CountA`関数で動的最終行を検出し、**変化に強い構造**  
- フルVBAのみで実現、外部ライブラリ不要  

---

## 🧾 利用環境
- 対応OS：Windows 10 / 11  
- 対応Excel：Microsoft Excel 2016以降（マクロ有効ブック対応）  
- セキュリティ設定：マクロ実行を許可  

---

## 🧱 ファイル構成
新規依頼に関するデータ分析/
├─ 新規依頼に関するデータ分析.xlsm # メインExcel（VBAマクロブック）
├─ 名前マッピング一覧.csv # 個人名を匿名化した対応表
└─ README.md # この説明書


---

## 🧑‍💼 制作背景
本ツールは、訪問看護ステーションにおける  
「新規依頼→契約までのプロセスを可視化する」目的で開発されました。  

Excel中心の運用現場でも、VBAの力で  
**属人的な集計業務を自動化し、分析指標をリアルタイムに可視化**できるようにしたものです。

---

## 👤 作者
**nylon0226**  
元・訪問看護ステーション経営企画担当。  
データ整備と現場の意思決定をつなぐ仕組みをつくる人。  

© 2025 nylon0226
